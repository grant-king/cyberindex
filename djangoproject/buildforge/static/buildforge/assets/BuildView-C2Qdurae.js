import{d as j,r as c,o as T,c as f,b as x,e as t,w as g,F as k,g as M,n as C,f as U,h as p,v as B,u,i as V}from"./index-BC4BI7_i.js";import{c9 as Y,cb as F}from"./voxel-D6zeumKD.js";const X=j("builder",()=>{const w=window.location.origin,n=`${w}/apiv1/placements/`;c(`${n}?page=1`);const o=`${w}/apiv1/builders/`;c(`${o}?page=1`);const y=`${o}my_builder/`;c([]);const d=c({session_id:0,x:0,y:0,z:0,edit_plane:"xy"});async function m(){const r=await fetch(y,{method:"GET",headers:{"X-CSRFToken":window.csrf_token}}),a=await r.json();r.ok?(console.log("my builder",a),d.value=a):(console.error("failed to fetch my builder"),console.error(r))}async function v(){const r=new FormData;r.append("x",d.value.x),r.append("y",d.value.y),r.append("z",d.value.z),r.append("edit_plane",d.value.edit_plane);const a=await fetch(y,{method:"PUT",headers:{"X-CSRFToken":window.csrf_token},body:r}),_=await a.json();a.ok?(console.log("updated builder",_),d.value=_):(console.error("failed to update builder"),console.error(a))}return{fetchMyBuilder:m,my_builder:d,updateBuilder:v}}),D={class:"font-mono font-bold text-white"},R={__name:"BuilderPosGizmo",setup(w){const n=X();T(async()=>{await n.fetchMyBuilder()});async function o(){n.my_builder.x++,await n.updateBuilder()}async function y(){n.my_builder.x--,await n.updateBuilder()}async function d(){n.my_builder.y++,await n.updateBuilder()}async function m(){n.my_builder.y--,await n.updateBuilder()}async function v(){n.my_builder.z++,await n.updateBuilder()}async function r(){n.my_builder.z--,await n.updateBuilder()}async function a(){n.my_builder.x++,n.my_builder.y++,await n.updateBuilder()}async function _(){n.my_builder.x--,n.my_builder.y--,await n.updateBuilder()}async function z(){n.my_builder.x++,n.my_builder.y--,await n.updateBuilder()}async function h(){n.my_builder.x--,n.my_builder.y++,await n.updateBuilder()}return(S,b)=>(x(),f("div",D,[t("div",{class:"bg-white/10 rounded-sm"},[t("div",{class:"grid grid-cols-3 gap-1 text-center place-content-around w-64 h-64"},[t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm",onClick:h}," X-&Y+ "),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:d}," Y+ "),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:a}," X+&Y+ "),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:y}," X- "),t("div",{class:"size-16 place-content-center"},[t("button",{class:"h-8 w-16 rounded-t-sm bg-white/10 hover:bg-white/20",onClick:v}," Z+ "),b[0]||(b[0]=t("hr",null,null,-1)),b[1]||(b[1]=t("hr",null,null,-1)),t("button",{class:"h-8 w-16 bg-white/10 rounded-b-sm hover:bg-white/20",onClick:r}," Z- ")]),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:o}," X+ "),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:_}," X-&Y- "),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:m}," Y- "),t("button",{class:"size-16 bg-white/10 hover:bg-white/20 rounded-sm place-content-center",onClick:z}," X+&Y- ")])])]))}},A={class:"bg-black overflow-auto max-w-4xl mx-auto p-4"},G={class:"grid grid-cols-16 gap-1"},q=["onClick"],E={class:"flex flex-wrap justify-center object-center"},I={class:"p-4 text-white"},N={class:"p-2"},P={class:"p-2"},W={class:"p-2"},Z={class:"p-4 text-white"},L={class:"p-2 flex objects-center"},H={class:"p-2 flex objects-center"},J={class:"p-2 flex objects-center"},K={class:"mx-auto"},O={class:"flex-wrap flex p-4"},te={__name:"BuildView",setup(w){const n=Y(),o=X(),y=F(),d=c("001100");c(0);const m=c({});c({});const v=c(Array.from({length:256},(i,e)=>e)),r=c(Array.from({length:256},(i,e)=>"000200"));T(async()=>{await n.fetchClaims(),h(),await o.fetchMyBuilder(),await a()}),g(()=>o.my_builder.x,async()=>{a()}),g(()=>o.my_builder.y,async()=>{a()}),g(()=>o.my_builder.z,async()=>{a()}),g(()=>o.my_builder.edit_plane,async()=>{a()});async function a(){m.value=await y.fetchVoxelsInSlice(o.my_builder.x,o.my_builder.y,o.my_builder.z,16,o.my_builder.edit_plane);const i=S(m.value);console.log("original",m.value),console.log("relative",i),r.value=b(i)}async function _(i){r.value[i]=d.value;const e=n.claim_list.shift(),{off_x:l,off_y:s,off_z:$}=z(i);console.log(l,s,$),await y.placeVoxel(e.voxel.pk,o.my_builder.x+l,o.my_builder.y+s,o.my_builder.z+$),await n.unholdClaim(e.pk,e.voxel.pk),h()}function z(i){if(o.my_builder.edit_plane==="xy"){const e=i%16,l=Math.floor(i/16),s=0;return console.log(e,l,s),{off_x:e,off_y:l,off_z:s}}if(o.my_builder.edit_plane==="yz"){const l=i%16,s=Math.floor(i/16);return{off_x:0,off_y:l,off_z:s}}if(o.my_builder.edit_plane==="zx"){const e=Math.floor(i/16),l=0,s=i%16;return{off_x:e,off_y:l,off_z:s}}}function h(){n.claim_list.length===0&&n.fetchClaims(),n.claim_list.length>0?d.value=n.claim_list[0].voxel.color:d.value="000200"}function S(i){return i.map(l=>({x:l.x-o.my_builder.x,y:l.y-o.my_builder.y,z:l.z-o.my_builder.z,color:l.color}))}function b(i){const e=Array.from({length:256},(l,s)=>"000200");for(let l of i){if(o.my_builder.edit_plane==="xy"){const s=l.x+l.y*16;e[s]=l.color}if(o.my_builder.edit_plane==="yz"){const s=l.y+l.z*16;e[s]=l.color}if(o.my_builder.edit_plane==="zx"){const s=l.z+l.x*16;e[s]=l.color}}return e}return(i,e)=>(x(),f(k,null,[t("div",{class:"border-16 border-dotted transfrom-flat rotate-x-180",style:C({borderColor:`#${d.value}`})},[t("div",A,[t("div",G,[(x(!0),f(k,null,M(v.value,l=>(x(),f("div",{key:l,class:"column"},[t("div",{class:"aspect-square w-auto border border-white/50",style:C({backgroundColor:`#${r.value[l]}`}),onClick:s=>_(l)},null,12,q)]))),128))])])],4),e[15]||(e[15]=t("div",null,null,-1)),e[16]||(e[16]=t("div",null,null,-1)),t("div",E,[U(R),t("div",I,[e[9]||(e[9]=t("div",null,"set builder origin",-1)),t("div",N,[e[6]||(e[6]=t("label",{for:"x",class:"mr-2"},"set x",-1)),p(t("input",{type:"number",id:"x",class:"bg-white/50 h-8 w-16 rounded-sm","onUpdate:modelValue":e[0]||(e[0]=l=>u(o).my_builder.x=l)},null,512),[[B,u(o).my_builder.x]])]),t("div",P,[e[7]||(e[7]=t("label",{for:"y",class:"mr-2"},"set y",-1)),p(t("input",{type:"number",id:"y",class:"bg-white/50 h-8 w-16 rounded-sm","onUpdate:modelValue":e[1]||(e[1]=l=>u(o).my_builder.y=l)},null,512),[[B,u(o).my_builder.y]])]),t("div",W,[e[8]||(e[8]=t("label",{for:"z",class:"mr-2"},"set z",-1)),p(t("input",{type:"number",id:"z",class:"bg-white/50 h-8 w-16 rounded-sm","onUpdate:modelValue":e[2]||(e[2]=l=>u(o).my_builder.z=l)},null,512),[[B,u(o).my_builder.z]])])]),t("div",Z,[e[13]||(e[13]=t("div",null,"set build plane",-1)),t("div",L,[e[10]||(e[10]=t("label",{for:"xy",class:"mr-2"},"select xy",-1)),p(t("input",{type:"radio",id:"xy",value:"xy",name:"plane","onUpdate:modelValue":e[3]||(e[3]=l=>u(o).my_builder.edit_plane=l),class:"h-8 w-8 rounded-sm"},null,512),[[V,u(o).my_builder.edit_plane]])]),t("div",H,[e[11]||(e[11]=t("label",{for:"yz",class:"mr-2"},"select yz",-1)),p(t("input",{type:"radio",id:"yz",value:"yz",name:"plane","onUpdate:modelValue":e[4]||(e[4]=l=>u(o).my_builder.edit_plane=l),class:"h-8 w-8 rounded-sm"},null,512),[[V,u(o).my_builder.edit_plane]])]),t("div",J,[e[12]||(e[12]=t("label",{for:"zx",class:"mr-2"},"select zx",-1)),p(t("input",{type:"radio",id:"zx",value:"zx",name:"plane","onUpdate:modelValue":e[5]||(e[5]=l=>u(o).my_builder.edit_plane=l),class:"h-8 w-8 rounded-sm"},null,512),[[V,u(o).my_builder.edit_plane]])])])]),t("div",K,[t("div",O,[(x(!0),f(k,null,M(u(n).claim_list,l=>(x(),f("div",{class:"p-1",key:l.voxel.pk},[t("div",{style:C({backgroundColor:`#${l.voxel.color}`}),class:"aspect-square w-auto border border-black"},e[14]||(e[14]=[t("div",{class:"w-4 h-4"},null,-1)]),4)]))),128))])])],64))}};export{te as default};
